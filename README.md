Тестовое задание Иванков Олег Евгеньевич 06.03.2024.

Необходимо подготовить скрипт сборки live образа Debian. 
Требования к скрипту сборки:
-полностью автоматизированная сборка - ✔️
-на выходе требуется получить готовый iso - ✔️
-управление списком устанавливаемых пакетов через конфигурационный файл - ✔️
-наличие комментариев в коде и описание использования - ✔️
логирование процесса; - ✔️

Описание и ход работы.

1.	В первую очередь для тестов я установил Debian 12.5 на виртуальную машину VirtualBox
2.	Затем нашел утилиту live-build, установил и начал разбираться как она работает.
Как написано в документации для начала необходимо прописать команду  «lb config» и она создаст дерево директорий:

  	![image](https://github.com/oleg310107/test-task/assets/80532580/e74c7c75-b0bc-4c57-b44d-8cdff64b3caa)

Далее, следуя документации, необходимо в папку auto создать свой скрипт config:
 
 ![image](https://github.com/oleg310107/test-task/assets/80532580/b5634168-000b-474c-84c7-eee75de34f03)

(Взял из примера в документации)

Потом, необходимо настроить управление списком устанавливаемых пакетов. Для этого потребуется редактировать существующий файл config/package-lists/desktop.list.chroot. Для теста добавил туда несколько пакетов:
 
 ![image](https://github.com/oleg310107/test-task/assets/80532580/d4fd157f-39b7-4312-afb3-a849ee54a7ad)


Теперь можно попробовать запустить lb build:
 
 ![image](https://github.com/oleg310107/test-task/assets/80532580/c52216f5-7115-4979-99c6-c2b5d3025ec6)

Эта попытка завершилась ошибкой, и первое, что я подумал - пакет debootstrap не установлен, но проблема оказалась не в этом, и пришлось искать другие методы исправления. Помогло только переустановка всех нужных пакетов с их зависимостями.
Итоговый скрипт выглядит так:

#!/bin/bash

# Требуемые параметры для скрипта:
# 1. Название папки для сборки
# 2. Название файла со списком необходимых для установки пакетов
# 3. Название файла для логов

# Мы предполагаем, что утилита live-build уже установлена, поэтому проверку на нее делать не буду
# Начнем с создания рабочей директории

if [ ! -d "$1" ]; then
	mkdir $1
else
	echo "Такая папка уже существует"
fi

# для удобства копируем конфигурационные файлы в нашу рабочую, только что созданную директорию
cp configfile $1/configfile
cp $2 $1/package-list

# Переходим в папку
cd $1

# Создадим необходимое дерево директорий
sudo lb config

# Скопируем файл-заготовку с конфигом в папку auto/ и допишем список пакетов в live.list.chroot
cp -r config auto/config
cat package-list >> config/package-lists/live.list.chroot

# эту строку пришлось добавить из-за того, что пакет firmware-linux не мог нормально установиться и вызывал ошибку 
echo "deb http://deb.debian.org/debian buster main contrib non-free" >> config/archives/debian.list.chroot


# Запускаем сборку с логированием в файл переданный нам в 3 параметре
sudo /usr/bin/lb build | tee $3

# Тут можно дописать удаление временных данных, но, думаю, пока это не критично

Запуск и проверка:
 
 ![image](https://github.com/oleg310107/test-task/assets/80532580/7eea4eda-f979-4219-a108-a8be19330e8b)

…
 
 ![image](https://github.com/oleg310107/test-task/assets/80532580/6ed68c5a-8c4d-4afa-b3be-b44ba6ce8c00)

Получилось, что был создан образ live-image-amd64.hybrid.iso:
 
 ![image](https://github.com/oleg310107/test-task/assets/80532580/fcca4e00-dcd7-4dad-b046-a8f4983c3db3)


Проверил в virtualbox получившийся образ 
  
  ![image](https://github.com/oleg310107/test-task/assets/80532580/dd877684-b85f-4c99-9a4f-eb4ece4d2235)
![image](https://github.com/oleg310107/test-task/assets/80532580/e2fccca5-dd50-4908-ab42-2568fbf4a226)

И на примере «cmatrix» понял, что пакеты указанные в файле конфигурации действительно были включены в образ:
 
 ![image](https://github.com/oleg310107/test-task/assets/80532580/6281eeae-53cf-4a55-be4c-689401a1ba6d)

